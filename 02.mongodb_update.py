# mongodb_update_fixed_v4.py
# yfinance + MongoDB 통합 업데이트 스크립트 (전역 세션 재사용 버전)

import os
import pandas as pd
import yfinance as yf
from datetime import datetime, timedelta
from pymongo import MongoClient
from pymongo.errors import ServerSelectionTimeoutError, BulkWriteError
from concurrent.futures import ThreadPoolExecutor, as_completed
from curl_cffi import requests
import ssl, certifi
import time
import numpy as np

# =========================================================
# 1️⃣ 환경 설정
# =========================================================
MONGO_URI = "mongodb://localhost:27017/"
DATABASE_NAME = "finance_db"
MAX_WORKERS = 4

COLLECTION_NAMES = {
    "us_stocks": "us_stocks",
    "korean_stocks": "korean_stocks",
    "indices": "indices",
    "currencies": "currencies",
}

HEADERS = {
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) '
                  'AppleWebKit/537.36 (KHTML, like Gecko) '
                  'Chrome/136.0.0.0 Safari/537.36'
}

# SSL 인증서 문제 해결용
ssl_context = ssl.create_default_context(cafile=certifi.where())

# ✅ 전역 세션 1회 생성 (모든 Ticker가 공유)
session = requests.Session(impersonate="chrome", headers=HEADERS, verify=False)

# =========================================================
# 2️⃣ 티커 목록
# =========================================================
def format_korean_tickers(tickers: list) -> list:
    """한국 주식 코드에 yfinance용 접미사(.KS/.KQ)를 붙입니다."""
    formatted = []
    for t in tickers:
        if t.endswith(('.KS', '.KQ')):
            formatted.append(t)
        elif len(t) == 6 and t.isdigit():
            formatted.append(f"{t}.KS")
        else:
            formatted.append(t)
    return formatted


TICKER_LISTS = {
    "currencies": [
        'KRW=X',
    'JPYKRW=X',
    'CADKRW=X',
    'SGDKRW=X',
    'EURKRW=X',
    'JPY=X',
    'CNY=X',
    'HKD=X',
    'SGD=X',
    'AUD=X',
    'DX-Y.NYB',
    'GBPUSD=X',
    'GBPEUR=X',
    'EURUSD=X',
    'GBPJPY=X',
    'EURJPY=X',
    ],
    "indices": [
        '^AORD',
    '^AXJO',
    '^BFX',
    '^BSESN',
    '^BUK100P',
    '^BVSP',
    '^DJI',
    '^DJT',
    '^FCHI',
    '^FTSE',
    '^FVX',
    '^GDAXI',
    '^GSPC',
    '^GSPTSE',
    '^HSCC',
    '^HSCE',
    '^HSI',
    '^IPSA',
    '^IXIC',
    '^JKSE',
    '^JN0U.JO',
    '^KLSE',
    '^KQ11',
    '^KS11',
    '^MERV',
    '^MXX',
    '^N100',
    '^N225',
    '^NDX',
    '^NYA',
    '^NZ50',
    '^OEX',
    '^RUA',
    '^RUI',
    '^RUT',
    '^SPX',
    '^STI',
    '^STOXX50E',
    '^TA125.TA',
    '^TWII',
    '^TYX',
    '^VIX',
    '^XAX',
    '^XDE',
    '000001.SS',
    '000002.SS',
    '399001.SZ',
    ],
    "us_stocks": [
        'A',
'AAL',
'AAPL',
'AAPY',
'ABBV',
'ABM',
'ABNY',
'ABT',
'ADC',
'ADP',
'AEE',
'AEP',
'AES',
'AFL',
'AGG',
'AGNC',
'AIG',
'AIPI',
'AIYY',
'ALB',
'ALL',
'AMAT',
'AMDY',
'AMGN',
'AMLP',
'AMZP',
'AMZY',
'AOA',
'AOK',
'AOM',
'APA',
'APD',
'APH',
'APLE',
'APLY',
'ARE',
'ARR',
'AVAL',
'AVB',
'AVGO',
'AVY',
'AWK',
'AWR',
'AXP',
'BAC',
'BALL',
'BAX',
'BDX',
'BEN',
'BETE',
'BETH',
'BIL',
'BITO',
'BITX',
'BIV',
'BK',
'BKH',
'BKLN',
'BLK',
'BLV',
'BMY',
'BND',
'BNDX',
'BR',
'BRHY',
'BRO',
'BSV',
'BUCK',
'BXP',
'C',
'CAG',
'CAH',
'CAT',
'CBSH',
'CCI',
'CCOI',
'CDUAF',
'CDW',
'CDX',
'CF',
'CGW',
'CHD',
'CHRW',
'CINF',
'CL',
'CLDT',
'CLX',
'CMA',
'CMI',
'CNP',
'CONY',
'COR',
'CRSH',
'CRT',
'CSCO',
'CSHI',
'CSX',
'CTSH',
'CTVA',
'CVS',
'CVX',
'CWT',
'D',
'DAL',
'DBC',
'DD',
'DE',
'DEM',
'DES',
'DG',
'DGRO',
'DGRW',
'DHR',
'DIA',
'DISO',
'DIV',
'DIVO',
'DLN',
'DOV',
'DOW',
'DPZ',
'DRETF',
'DREUF',
'DRI',
'DTE',
'DUK',
'DVN',
'DVY',
'DVYE',
'DWX',
'DX',
'EA',
'ED',
'EEM',
'EETH',
'EFA',
'EFC',
'EFX',
'EL',
'ELV',
'EMB',
'EMCC',
'EMN',
'EMR',
'EPR',
'ERNZ',
'ES',
'ESS',
'ETHD',
'ETR',
'EWJ',
'EXR',
'F',
'FBND',
'FBY',
'FCX',
'FDS',
'FE',
'FEPI',
'FIAT',
'FIW',
'FMC',
'FMCB',
'FNGU',
'FRT',
'FTQI',
'FUL',
'GAIN',
'GE',
'GILD',
'GIS',
'GLAD',
'GLD',
'GNR',
'GOF',
'GOOD',
'GOOP',
'GOOY',
'GORO',
'GOVT',
'GPC',
'GPIQ',
'GRC',
'GRID',
'GROW',
'GS',
'GSG',
'GWRS',
'GWW',
'GYLD',
'HAL',
'HAS',
'HBAN',
'HCA',
'HDV',
'HES',
'HIGH',
'HIPS',
'HLT',
'HPE',
'HPQ',
'HRL',
'HRZN',
'HSY',
'HTGC',
'HUM',
'HWM',
'HYG',
'HYGW',
'HYIN',
'IBM',
'ICE',
'IDV',
'IEF',
'IEI',
'IGBH',
'IGIB',
'IGSB',
'INTC',
'INTU',
'IP',
'IQQQ',
'ITUB',
'ITW',
'IUSB',
'IVV',
'IWB',
'IWC',
'IWM',
'IWMI',
'IWMW',
'IWMY',
'IWN',
'IWO',
'IWR',
'IWV',
'IYRI',
'JCI',
'JEPI',
'JEPQ',
'JEPY',
'JNJ',
'JNK',
'JPM',
'JPMO',
'JPST',
'K',
'KBWD',
'KBWY',
'KEY',
'KHYB',
'KIM',
'KLAC',
'KLIP',
'KMB',
'KMI',
'KO',
'LANC',
'LAND',
'LDOS',
'LEG',
'LLY',
'LMT',
'LOW',
'LQD',
'LQDW',
'LTC',
'LUV',
'LW',
'MA',
'MAA',
'MAIN',
'MAR',
'MAXI',
'MBB',
'MCD',
'MCK',
'MCO',
'MDLZ',
'MDST',
'MET',
'MINT',
'MLM',
'MLPD',
'MMM',
'MO',
'MOS',
'MPC',
'MPWR',
'MRK',
'MRNY',
'MSA',
'MSCI',
'MSFO',
'MSFT',
'MSFY',
'MSI',
'MSTY',
'MTB',
'MTR',
'MUB',
'NDSN',
'NEE',
'NFG',
'NFLP',
'NFLY',
'NI',
'NOBL',
'NOC',
'NTAP',
'NTRS',
'NUE',
'NVDY',
'NWN',
'NXPI',
'O',
'OARK',
'OKE',
'ORC',
'OXSQ',
'PARA',
'PAYX',
'PBA',
'PBP',
'PBT',
'PEG',
'PEP',
'PEY',
'PFE',
'PFF',
'PFFA',
'PFLT',
'PG',
'PGF',
'PGR',
'PH',
'PHO',
'PKG',
'PLD',
'PM',
'PNC',
'PPG',
'PPL',
'PPRQF',
'PRMN',
'PRT',
'PSA',
'PSEC',
'PSH',
'PSX',
'PUTW',
'PVL',
'PWR',
'PYPY',
'QQQ',
'QQQI',
'QQQT',
'QQQY',
'QSR',
'QTEC',
'QYLD',
'QYLE',
'QYLG',
'RF',
'RIET',
'RINC',
'ROK',
'ROL',
'ROP',
'ROST',
'RSG',
'RSP',
'RSPT',
'RYLD',
'SBR',
'SBUX',
'SCHD',
'SCHH',
'SCHO',
'SCHP',
'SCHW',
'SCL',
'SDIV',
'SDY',
'SGOV',
'SHV',
'SHY',
'SHYG',
'SJM',
'SJNK',
'SJT',
'SJW',
'SLG',
'SLYG',
'SLYV',
'SNA',
'SNOY',
'SO',
'SPGI',
'SPHD',
'SPLG',
'SPMD',
'SPTL',
'SPY',
'SPYI',
'SPYT',
'SQY',
'SRE',
'SRET',
'STAG',
'STT',
'STX',
'SUB',
'SUNS',
'SUUIF',
'SVOL',
'SWK',
'SWKS',
'SYK',
'SYY',
'T',
'TAP',
'TECH',
'TFLO',
'TGT',
'TIP',
'TJX',
'TLT',
'TLTI',
'TLTW',
'TMO',
'TNC',
'TR',
'TROW',
'TRV',
'TSCO',
'TSLP',
'TSLY',
'TSN',
'TT',
'TUGN',
'TXT',
'TYLG',
'UAL',
'UEVM',
'UIVM',
'ULTY',
'UNP',
'USB',
'USFR',
'USHY',
'USIG',
'USMV',
'USOY',
'UVV',
'V',
'VCIT',
'VCLT',
'VCSH',
'VEA',
'VET',
'VFC',
'VGIT',
'VGK',
'VGLT',
'VGSH',
'VICI',
'VIG',
'VIGI',
'VMBS',
'VNQ',
'VOO',
'VRSK',
'VTEB',
'VTI',
'VTV',
'VUG',
'VWO',
'VYM',
'VZ',
'WAB',
'WBA',
'WEEI',
'WELL',
'WFC',
'WMB',
'WMT',
'WSR',
'XAR',
'XBI',
'XCCC',
'XEL',
'XLP',
'XLRE',
'XLV',
'XOM',
'XOMO',
'XRMI',
'XYLD',
'XYLE',
'XYLG',
'YBIT',
'YBTC',
'YMAG',
'YMAX',
'YUM',
'YYY',
'ZBH',
'ZTS',
    ],
    "korean_stocks": format_korean_tickers([
        "000020",
"000040",
"000050",
"000070",
"000075",
"000080",
"000087",
"0000D0",
"0000H0",
"0000J0",
"0000Y0",
"0000Z0",
"000100",
"000105",
"000120",
"000140",
"000145",
"000150",
"000155",
"000157",
"000180",
"0001P0",
"0001S0",
"000210",
"000215",
"000220",
"000225",
"000227",
"000230",
"000240",
"000250",
"000270",
"0002C0",
"000300",
"000320",
"000325",
"000370",
"000390",
"000400",
"000430",
"000440",
"000480",
"000490",
"0004G0",
"0004Y0",
"000500",
"000520",
"000540",
"000545",
"000590",
"0005A0",
"0005C0",
"0005D0",
"0005G0",
"000640",
"000650",
"000660",
"000670",
"000680",
"000700",
"000720",
"000725",
"000760",
"0007F0",
"0007G0",
"0007N0",
"000810",
"000815",
"000850",
"000860",
"000880",
"000885",
"00088K",
"000890",
"0008E0",
"0008S0",
"0008T0",
"0008Z0",
"000910",
"000950",
"000970",
"000990",
"001000",
"001020",
"001040",
"001045",
"00104K",
"001060",
"001065",
"001067",
"001070",
"001080",
"0010E0",
"0010V0",
"001120",
"001130",
"001140",
"001200",
"001210",
"001230",
"001250",
"001260",
"001270",
"001275",
"001290",
"001340",
"001360",
"001380",
"001390",
"0013P0",
"0013R0",
"001420",
"001430",
"001440",
"001450",
"001460",
"001465",
"001470",
"001500",
"001510",
"001515",
"001520",
"001525",
"001527",
"001530",
"001540",
"001550",
"001560",
"001570",
"0015B0",
"0015E0",
"0015F0",
"0015K0",
"001620",
"001630",
"001680",
"001685",
"0016X0",
"001720",
"001725",
"001740",
"001750",
"001755",
"001770",
"001780",
"001790",
"001795",
"0017Y0",
"001800",
"001810",
"001820",
"001840",
"001880",
"0018C0",
"0018Z0",
"001940",
"0019K0",
"002020",
"002025",
"002030",
"002070",
"0020H0",
"002100",
"002140",
"002150",
"002170",
"0021C0",
"0021D0",
"0021E0",
"002200",
"002210",
"002220",
"002230",
"002240",
"002290",
"0022T0",
"002310",
"002320",
"002350",
"002355",
"002360",
"002380",
"002390",
"0023A0",
"0023B0",
"002410",
"002420",
"002450",
"002460",
"0025N0",
"002600",
"002620",
"002630",
"002680",
"002690",
"0026E0",
"0026S0",
"002700",
"002710",
"002720",
"002760",
"002780",
"002785",
"002787",
"002790",
"002795",
"00279K",
"002800",
"002810",
"002820",
"002840",
"002870",
"002880",
"0028X0",
"002900",
"002920",
"002960",
"002990",
"002995",
"003000",
"003010",
"003030",
"003060",
"003070",
"003075",
"003080",
"003090",
"0030R0",
"003100",
"003120",
"003160",
"003200",
"003220",
"003230",
"003240",
"003280",
"003300",
"003310",
"003350",
"003380",
"003410",
"003460",
"003465",
"003470",
"003475",
"003480",
"003490",
"003495",
"003520",
"003530",
"003535",
"003540",
"003545",
"003547",
"003550",
"003555",
"003560",
"003570",
"003580",
"0035T0",
"003610",
"003620",
"003650",
"003670",
"003680",
"003690",
"0036D0",
"0036R0",
"0036Z0",
"003720",
"003780",
"0037T0",
"003800",
"003830",
"003850",
"0038A0",
"003920",
"003925",
"003960",
"004000",
"004020",
"004060",
"004080",
"004090",
"0040S0",
"0040X0",
"0040Y0",
"004100",
"004105",
"004140",
"004150",
"004170",
"0041B0",
"0041D0",
"0041E0",
"0041J0",
"0041L0",
"004250",
"004255",
"004270",
"004310",
"004360",
"004365",
"004370",
"004380",
"0043B0",
"0043Y0",
"004410",
"004415",
"004430",
"004440",
"004450",
"004490",
"0044K0",
"004540",
"004545",
"004560",
"004590",
"004650",
"004690",
"0046A0",
"0046Y0",
"004700",
"004710",
"004720",
"004770",
"004780",
"0047A0",
"0047N0",
"0047P0",
"0047R0",
"004800",
"004830",
"004835",
"004840",
"004870",
"004890",
"0048J0",
"0048K0",
"004910",
"004920",
"004960",
"004970",
"004980",
"004985",
"004990",
"00499K",
"0049K0",
"0049M0",
"005010",
"005030",
"005070",
"005090",
"0050E0",
"005110",
"005160",
"005180",
"0051A0",
"0051G0",
"005250",
"005257",
"005290",
"0052D0",
"0052S0",
"0052T0",
"005300",
"005305",
"005320",
"005360",
"005380",
"005385",
"005387",
"005389",
"005390",
"0053L0",
"0053M0",
"005420",
"005430",
"005440",
"005490",
"005500",
"005610",
"005670",
"005680",
"005690",
"005710",
"005720",
"005725",
"005740",
"005745",
"005750",
"0057H0",
"005800",
"005810",
"005820",
"005830",
"005850",
"005860",
"005870",
"005880",
"005930",
"005935",
"005940",
"005945",
"005950",
"005960",
"005965",
"005990",
"006040",
"006050",
"006060",
"006090",
"0060H0",
"006110",
"006120",
"006125",
"006140",
"0061Z0",
"006200",
"006220",
"006260",
"006280",
"006340",
"006345",
"006360",
"006370",
"006380",
"006390",
"006400",
"006405",
"006490",
"0064K0",
"006570",
"006580",
"0065G0",
"006620",
"006650",
"006660",
"0066W0",
"006730",
"006740",
"0067V0",
"0067Y0",
"006800",
"006805",
"00680K",
"006840",
"006880",
"006890",
"0068M0",
"006910",
"006920",
"006980",
"0069M0",
"007070",
"007110",
"007120",
"007160",
"0071M0",
"007210",
"007280",
"0072R0",
"0072Z0",
"007310",
"007330",
"007340",
"007370",
"007390",
"0073X0",
"007460",
"0074K0",
"007530",
"007540",
"007570",
"007575",
"007590",
"007610",
"007660",
"007680",
"007690",
"007700",
"007720",
"007770",
"007810",
"007815",
"00781K",
"007820",
"007860",
"0078V0",
"007980",
"0079X0",
"008040",
"008060",
"00806K",
"0080G0",
"0080X0",
"0080Y0",
"008110",
"008250",
"008260",
"008290",
"0082F0",
"0082V0",
"008350",
"008355",
"008370",
"0083S0",
"008420",
"008470",
"008490",
"0084D0",
"008500",
"0085N0",
"0085P0",
"008600",
"0086B0",
"0086C0",
"008700",
"008730",
"008770",
"008775",
"0087F0",
"008830",
"008870",
"0088N0",
"008930",
"008970",
"0089B0",
"0089C0",
"0089D0",
"009070",
"0090B0",
"009140",
"009150",
"009155",
"009160",
"009180",
"009190",
"0091C0",
"0091M0",
"0091P0",
"009200",
"009240",
"009270",
"009290",
"0092B0",
"0092C0",
"009300",
"009310",
"009320",
"0093A0",
"0093B0",
"0093D0",
"009410",
"009415",
"009420",
"009440",
"009450",
"009460",
"009470",
"0094K0",
"0094L0",
"0094M0",
"0094X0",
"009520",
"009540",
"009580",
"009620",
"009680",
"009730",
"009770",
"009780",
"0097L0",
"009810",
"009830",
"009835",
"0098F0",
"0098N0",
"0098Z0",
"009900",
"009970",
"0099L0",
"010040",
"010060",
"0100K0",
"010100",
"010120",
"010130",
"010140",
"010170",
"0101N0",
"010240",
"010280",
"0102A0",
"0102X0",
"0103T0",
"010400",
"010420",
"010470",
"0104G0",
"0104H0",
"0104N0",
"0104P0",
"010580",
"0105D0",
"0105E0",
"010600",
"010620",
"010640",
"010660",
"010690",
"010770",
"010780",
"0107F0",
"010820",
"010950",
"010955",
"010960",
"011000",
"011040",
"011070",
"011080",
"011090",
"011150",
"011155",
"011170",
"0111P0",
"011200",
"011210",
"011230",
"011280",
"011300",
"011320",
"011330",
"011370",
"011390",
"0113P0",
"011420",
"011500",
"011560",
"011690",
"011700",
"011760",
"011780",
"011785",
"011790",
"011810",
"011930",
"012030",
"012160",
"012170",
"012200",
"012205",
"012210",
"012280",
"012320",
"012330",
"012340",
"012450",
"012510",
"012600",
"012610",
"012620",
"012630",
"012690",
"012700",
"012750",
"012790",
"012800",
"012860",
"013000",
"013030",
"013120",
"013310",
"013360",
"013520",
"013570",
"013580",
"013700",
"013720",
"013810",
"013870",
"013890",
"013990",
"014100",
"014130",
"014160",
"014190",
"014200",
"014280",
"014285",
"014440",
"014470",
"014530",
"014570",
"014580",
"014620",
"014680",
"014710",
"014790",
"014820",
"014825",
"014830",
"014910",
"014915",
"014940",
"014970",
"014990",
"015020",
"015230",
"015260",
"015360",
"015590",
"015710",
"015750",
"015760",
"015860",
"015890",
"016090",
"016100",
"016250",
"016360",
"016380",
"016450",
"016580",
"016590",
"016600",
"016610",
"016670",
"016710",
"016740",
"016790",
"016800",
"016880",
"016920",
"017000",
"017040",
"017180",
"017250",
"017370",
"017390",
"017480",
"017510",
"017550",
"017650",
"017670",
"017800",
"017810",
"017860",
"017890",
"017900",
"017940",
"017960",
"018000",
"018120",
"018250",
"018260",
"018290",
"018310",
"018470",
"018500",
"018620",
"018670",
"018680",
"018700",
"018880",
"019010",
"019170",
"019175",
"019180",
"019210",
"019440",
"019490",
"019540",
"019550",
"019570",
"019590",
"019660",
"019680",
"019685",
"019770",
"019990",
"020000",
"020120",
"020150",
"020180",
"020400",
"020560",
"020710",
"020760",
"021040",
"021045",
"021050",
"021080",
"021240",
"021320",
"021650",
"021820",
"021880",
"022100",
"022220",
"023000",
"023150",
"023160",
"023350",
"023410",
"023440",
"023450",
"023460",
"023530",
"023590",
"023600",
"023760",
"023770",
"023790",
"023800",
"023810",
"023900",
"023910",
"023960",
"024060",
"024070",
"024090",
"024110",
"024120",
"024720",
"024740",
"024800",
"024810",
"024830",
"024840",
"024850",
"024880",
"024890",
"024900",
"024910",
"024940",
"024950",
"025000",
"025320",
"025440",
"025530",
"025540",
"025550",
"025560",
"025620",
"025750",
"025770",
"025820",
"025860",
"025870",
"025880",
"025890",
"025900",
"025950",
"025980",
"026040",
"026150",
"026890",
"026910",
"026940",
"026960",
"027040",
"027050",
"027360",
"027410",
"027580",
"027710",
"027740",
"027830",
"027970",
"028050",
"028080",
"028100",
"028260",
"02826K",
"028300",
"028670",
"029460",
"029480",
"029530",
"029780",
"029960",
"030000",
"030190",
"030200",
"030210",
"030350",
"030520",
"030530",
"030610",
"030720",
"030790",
"030960",
"031210",
"031310",
"031330",
"031430",
"031440",
"031510",
"031820",
"031860",
"031980",
"032080",
"032190",
"032280",
"032300",
"032350",
"032500",
"032540",
"032560",
"032580",
"032620",
"032640",
"032680",
"032685",
"032750",
"032790",
"032800",
"032820",
"032830",
"032850",
"032860",
"032940",
"032960",
"032980",
"033050",
"033100",
"033130",
"033160",
"033170",
"033180",
"033200",
"033230",
"033240",
"033250",
"033270",
"033290",
"033310",
"033320",
"033340",
"033500",
"033530",
"033540",
"033560",
"033640",
"033780",
"033790",
"033830",
"033920",
"034020",
"034120",
"034220",
"034230",
"034300",
"034310",
"034590",
"034730",
"03473K",
"034810",
"03481K",
"034830",
"034940",
"034950",
"035000",
"035080",
"035150",
"035200",
"035250",
"035290",
"035420",
"035460",
"035510",
"035600",
"035610",
"035620",
"035720",
"035760",
"035810",
"035890",
"035900",
"036000",
"036010",
"036030",
"036090",
"036120",
"036170",
"036180",
"036190",
"036200",
"036220",
"036420",
"036460",
"036480",
"036530",
"036540",
"036560",
"036570",
"036580",
"036620",
"036630",
"036640",
"036670",
"036690",
"036710",
"036800",
"036810",
"036830",
"036890",
"036930",
"037030",
"037070",
"037230",
"037270",
"037330",
"037350",
"037370",
"037400",
"037440",
"037460",
"037560",
"037710",
"037760",
"037950",
"038010",
"038060",
"038070",
"038110",
"038290",
"038340",
"038390",
"038460",
"038500",
"038530",
"038540",
"038620",
"038680",
"038870",
"038880",
"038950",
"039010",
"039020",
"039030",
"039130",
"039200",
"039240",
"039290",
"039310",
"039340",
"039420",
"039440",
"039490",
"039560",
"039570",
"039610",
"039740",
"039830",
"039840",
"039860",
"039980",
"040160",
"040300",
"040350",
"040420",
"040610",
"040910",
"041020",
"041190",
"041440",
"041460",
"041510",
"041520",
"041590",
"041650",
"041830",
"041910",
"041920",
"041930",
"041960",
"042000",
"042040",
"042110",
"042370",
"042420",
"042500",
"042510",
"042520",
"042600",
"042660",
"042670",
"042700",
"042940",
"043090",
"043100",
"043150",
"043200",
"043220",
"043260",
"043340",
"043360",
"043370",
"043590",
"043610",
"043650",
"043710",
"043910",
"044060",
"044180",
"044340",
"044380",
"044450",
"044480",
"044490",
"044780",
"044820",
"044960",
"044990",
"045060",
"045100",
"045300",
"045340",
"045390",
"045510",
"045520",
"045660",
"045970",
"046070",
"046120",
"046140",
"046210",
"046310",
"046390",
"046440",
"046890",
"046940",
"046970",
"047040",
"047050",
"047080",
"047310",
"047400",
"047560",
"047770",
"047810",
"047820",
"047920",
"048410",
"048430",
"048470",
"048530",
"048550",
"048770",
"048830",
"048870",
"048910",
"049070",
"049080",
"049120",
"049180",
"049430",
"049470",
"049480",
"049520",
"049550",
"049630",
"049720",
"049770",
"049800",
"049830",
"049950",
"049960",
"050090",
"050110",
"050120",
"050760",
"050860",
"050890",
"050960",
"051160",
"051360",
"051370",
"051380",
"051390",
"051490",
"051500",
"051600",
"051630",
"051780",
"051900",
"051905",
"051910",
"051915",
"051980",
"052020",
"052220",
"052260",
"052300",
"052330",
"052400",
"052420",
"052460",
"052600",
"052670",
"052690",
"052710",
"052770",
"052790",
"052860",
"052900",
"052960",
"053030",
"053050",
"053060",
"053080",
"053160",
"053210",
"053260",
"053270",
"053280",
"053290",
"053300",
"053350",
"053450",
"053580",
"053590",
"053610",
"053620",
"053690",
"053700",
"053800",
"053950",
"053980",
"054040",
"054050",
"054090",
"054180",
"054210",
"054220",
"054300",
"054410",
"054450",
"054540",
"054620",
"054630",
"054670",
"054780",
"054800",
"054920",
"054930",
"054940",
"054950",
"055490",
"055550",
"056080",
"056090",
"056190",
"056360",
"056700",
"056730",
"057030",
"057050",
"057540",
"057680",
"057880",
"058110",
"058220",
"058400",
"058430",
"058450",
"058470",
"058530",
"058610",
"058630",
"058650",
"058730",
"058820",
"058850",
"058860",
"058970",
"059090",
"059100",
"059120",
"059210",
"059270",
"060150",
"060230",
"060240",
"060250",
"060260",
"060280",
"060310",
"060370",
"060380",
"060480",
"060540",
"060560",
"060570",
"060590",
"060720",
"060850",
"060900",
"060980",
"061040",
"061250",
"061970",
"062040",
"062860",
"062970",
"063080",
"063160",
"063170",
"063440",
"063570",
"063760",
"064090",
"064240",
"064260",
"064290",
"064350",
"064400",
"064480",
"064520",
"064550",
"064760",
"064800",
"064820",
"064850",
"064960",
"065060",
"065130",
"065150",
"065170",
"065350",
"065370",
"065420",
"065440",
"065450",
"065500",
"065510",
"065530",
"065560",
"065570",
"065650",
"065660",
"065680",
"065690",
"065710",
"065770",
"065950",
"066130",
"066310",
"066360",
"066410",
"066430",
"066570",
"066575",
"066590",
"066620",
"066670",
"066700",
"066790",
"066830",
"066900",
"066910",
"066970",
"066980",
"067000",
"067010",
"067080",
"067160",
"067170",
"067280",
"067290",
"067310",
"067370",
"067390",
"067570",
"067630",
"067730",
"067770",
"067830",
"067900",
"067920",
"067990",
"068050",
"068100",
"068240",
"068270",
"068290",
"068330",
"068400",
"068760",
"068790",
"068930",
"068940",
"069080",
"069140",
"069260",
"069330",
"069410",
"069460",
"069500",
"069510",
"069540",
"069620",
"069640",
"069660",
"069730",
"069920",
"069960",
"070300",
"070590",
"070960",
"071050",
"071055",
"071090",
"071200",
"071280",
"071320",
"071460",
"071670",
"071840",
"071850",
"071950",
"071970",
"072020",
"072130",
"072470",
"072520",
"072710",
"072770",
"072870",
"072950",
"072990",
"073010",
"073110",
"073190",
"073240",
"073490",
"073540",
"073560",
"073570",
"073640",
"074430",
"074600",
"074610",
"075130",
"075180",
"075580",
"075970",
"076080",
"076340",
"076610",
"077360",
"077500",
"077970",
"078000",
"078020",
"078070",
"078130",
"078140",
"078150",
"078160",
"078340",
"078350",
"078520",
"078590",
"078600",
"078860",
"078890",
"078930",
"078935",
"078940",
"079000",
"079160",
"079170",
"079190",
"079370",
"079430",
"079550",
"079650",
"079810",
"079900",
"079940",
"079950",
"079960",
"079970",
"079980",
"080000",
"080010",
"080160",
"080220",
"080420",
"080470",
"080520",
"080530",
"080580",
"080720",
"081000",
"081150",
"081180",
"081580",
"081660",
"082210",
"082270",
"082640",
"082660",
"082740",
"082800",
"082850",
"082920",
"083310",
"083420",
"083450",
"083470",
"083500",
"083550",
"083640",
"083650",
"083660",
"083790",
"083930",
"084010",
"084110",
"084180",
"084370",
"084440",
"084650",
"084670",
"084680",
"084690",
"084695",
"084730",
"084850",
"084870",
"084990",
"085310",
"085620",
"085660",
"085670",
"085810",
"085910",
"086040",
"086060",
"086220",
"086280",
"086390",
"086450",
"086460",
"086520",
"086670",
"086710",
"086790",
"086820",
"086890",
"086900",
"086960",
"086980",
"087010",
"087260",
"087600",
"088130",
"088260",
"088280",
"088290",
"088340",
"088350",
"088390",
"088790",
"088800",
"088910",
"088980",
"089010",
"089030",
"089140",
"089150",
"089230",
"089470",
"089530",
"089590",
"089600",
"089790",
"089850",
"089860",
"089890",
"089970",
"089980",
"090080",
"090150",
"090350",
"090355",
"090360",
"090370",
"090410",
"090430",
"090435",
"090460",
"090470",
"090710",
"090850",
"091090",
"091120",
"091160",
"091170",
"091180",
"091220",
"091230",
"091340",
"091440",
"091580",
"091590",
"091700",
"091810",
"091970",
"091990",
"092040",
"092070",
"092130",
"092190",
"092200",
"092220",
"092230",
"092300",
"092440",
"092460",
"092590",
"092600",
"092730",
"092780",
"092790",
"092870",
"093050",
"093190",
"093230",
"093240",
"093320",
"093370",
"093380",
"093510",
"093520",
"093640",
"093920",
"094170",
"094280",
"094360",
"094480",
"094800",
"094820",
"094840",
"094850",
"094860",
"094940",
"094970",
"095190",
"095270",
"095340",
"095500",
"095570",
"095610",
"095660",
"095700",
"095720",
"095910",
"096040",
"096240",
"096250",
"096350",
"096530",
"096610",
"096630",
"096690",
"096760",
"096770",
"096775",
"096870",
"097230",
"097520",
"097780",
"097800",
"097870",
"097950",
"097955",
"098070",
"098120",
"098460",
"098560",
"098660",
"099140",
"099190",
"099220",
"099320",
"099390",
"099410",
"099430",
"099440",
"099520",
"099750",
"100030",
"100090",
"100120",
"100130",
"100220",
"100250",
"100590",
"100660",
"100700",
"100790",
"100840",
"100910",
"101000",
"101140",
"101160",
"101170",
"101240",
"101280",
"101330",
"101360",
"101390",
"101400",
"101490",
"101530",
"101670",
"101680",
"101730",
"101930",
"101970",
"102110",
"102120",
"102260",
"102280",
"102370",
"102460",
"102710",
"102780",
"102940",
"102950",
"102960",
"102970",
"103140",
"103230",
"103590",
"103660",
"103840",
"104040",
"104200",
"104460",
"104480",
"104520",
"104530",
"104540",
"104620",
"104700",
"104830",
"105010",
"105190",
"105330",
"105550",
"105560",
"105630",
"105740",
"105760",
"105780",
"105840",
"106080",
"106190",
"106240",
"106520",
"107590",
"107600",
"107640",
"108230",
"108320",
"108380",
"108450",
"108490",
"108590",
"108670",
"108675",
"108860",
"109070",
"109080",
"109610",
"109670",
"109740",
"109820",
"109860",
"109960",
"110020",
"110790",
"110990",
"111110",
"111380",
"111710",
"111770",
"111870",
"112040",
"112190",
"112290",
"112610",
"113810",
"114090",
"114100",
"114120",
"114190",
"114260",
"114450",
"114460",
"114470",
"114630",
"114800",
"114810",
"114820",
"114840",
"114920",
"115160",
"115180",
"115310",
"115390",
"115440",
"115450",
"115480",
"115500",
"115530",
"115570",
"115610",
"115960",
"116100",
"117460",
"117580",
"117670",
"117680",
"117690",
"117700",
"117730",
"118000",
"118990",
"119500",
"119610",
"119650",
"119830",
"119850",
"119860",
"120030",
"120110",
"120115",
"120240",
"121060",
"121440",
"121600",
"121800",
"121850",
"121890",
"122090",
"122260",
"122310",
"122350",
"122450",
"122630",
"122640",
"122690",
"122830",
"122870",
"122900",
"122990",
"123010",
"123040",
"123310",
"123320",
"123330",
"123410",
"123420",
"123570",
"123690",
"123700",
"123750",
"123840",
"123860",
"123890",
"124500",
"124560",
"125020",
"125210",
"125490",
"126340",
"126560",
"126600",
"126640",
"126700",
"126720",
"126730",
"126880",
"127120",
"127710",
"127980",
"128540",
"128660",
"128820",
"128940",
"129260",
"129890",
"129920",
"130500",
"130580",
"130660",
"130680",
"130730",
"130740",
"131030",
"131090",
"131100",
"131180",
"131220",
"131290",
"131370",
"131400",
"131760",
"131890",
"131970",
"132030",
"133690",
"133750",
"133820",
"134060",
"134380",
"134580",
"134790",
"136150",
"136340",
"136410",
"136480",
"136490",
"136510",
"136540",
"136660",
"137080",
"137310",
"137400",
"137610",
"137940",
"137950",
"138040",
"138070",
"138080",
"138230",
"138360",
"138490",
"138520",
"138530",
"138540",
"138580",
"138610",
"138690",
"138910",
"138920",
"138930",
"139050",
"139130",
"139220",
"139230",
"139240",
"139250",
"139260",
"139270",
"139280",
"139290",
"139310",
"139320",
"139480",
"139660",
"139670",
"139990",
"140070",
"140410",
"140430",
"140520",
"140570",
"140580",
"140610",
"140660",
"140670",
"140700",
"140710",
"140860",
"140910",
"140950",
"141000",
"141020",
"141080",
"142210",
"142280",
"142760",
"143160",
"143210",
"143240",
"143460",
"143540",
"143850",
"143860",
"144510",
"144600",
"144960",
"145020",
"145170",
"145210",
"145270",
"145670",
"145720",
"145850",
"145990",
"145995",
"146060",
"146320",
"147760",
"147830",
"147970",
"148020",
"148070",
"148140",
"148150",
"148250",
"148780",
"148930",
"149010",
"149300",
"149950",
"149980",
"150440",
"150460",
"150840",
"150900",
"151860",
"151910",
"152100",
"152380",
"152500",
"152550",
"152870",
"153130",
"153270",
"153460",
"153490",
"153710",
"154030",
"154040",
"155650",
"155660",
"156080",
"156100",
"157450",
"157490",
"157500",
"158430",
"159010",
"159580",
"159800",
"159910",
"160190",
"160550",
"160580",
"160600",
"160980",
"161000",
"161390",
"161510",
"161570",
"161580",
"161890",
"162120",
"162300",
"163280",
"163430",
"163560",
"163730",
"164060",
"166090",
"166400",
"166480",
"167860",
"168330",
"168360",
"168490",
"168580",
"169330",
"169670",
"169950",
"170030",
"170790",
"170900",
"170920",
"171010",
"171090",
"171120",
"172670",
"173130",
"173940",
"174350",
"174360",
"174880",
"174900",
"175140",
"175250",
"175330",
"176590",
"176750",
"176950",
"177350",
"177830",
"177900",
"178320",
"178600",
"178780",
"178920",
"179290",
"179530",
"179720",
"179900",
"180060",
"180400",
"180640",
"18064K",
"181340",
"181480",
"181710",
"182360",
"182400",
"182480",
"182490",
"183190",
"183300",
"183410",
"183490",
"183700",
"183710",
"184230",
"185190",
"185490",
"185680",
"185750",
"186230",
"187220",
"187270",
"187420",
"187660",
"187790",
"187870",
"188040",
"188260",
"189300",
"189330",
"189350",
"189400",
"189690",
"189860",
"189980",
"190510",
"190620",
"190650",
"191410",
"191420",
"191600",
"192080",
"192090",
"192250",
"192390",
"192400",
"192410",
"192440",
"192650",
"192720",
"192820",
"193250",
"194370",
"194480",
"194700",
"195500",
"195870",
"195920",
"195930",
"195940",
"195970",
"195980",
"195990",
"196030",
"196170",
"196230",
"196300",
"196450",
"196490",
"196700",
"197140",
"198080",
"198440",
"198940",
"199150",
"199290",
"199430",
"199480",
"199550",
"199730",
"199800",
"199820",
"200030",
"200130",
"200230",
"200250",
"200350",
"200470",
"200580",
"200670",
"200710",
"200780",
"200880",
"201490",
"202960",
"203400",
"203450",
"203650",
"203690",
"203780",
"204020",
"204210",
"204270",
"204320",
"204450",
"204480",
"204610",
"204620",
"204630",
"204840",
"205100",
"205470",
"205500",
"205720",
"206400",
"206560",
"206640",
"206650",
"206950",
"207490",
"207760",
"207940",
"208140",
"208340",
"208350",
"208370",
"208640",
"208710",
"208850",
"208860",
"208890",
"209640",
"210120",
"210540",
"210780",
"210980",
"211050",
"211270",
"211560",
"211900",
"212310",
"212560",
"212710",
"213420",
"213500",
"213610",
"213630",
"214150",
"214180",
"214260",
"214270",
"214310",
"214320",
"214330",
"214370",
"214390",
"214420",
"214430",
"214450",
"214610",
"214680",
"214870",
"214980",
"215000",
"215090",
"215100",
"215200",
"215360",
"215380",
"215480",
"215570",
"215600",
"215620",
"215790",
"216050",
"216080",
"216400",
"217190",
"217270",
"217320",
"217330",
"217480",
"217500",
"217620",
"217730",
"217770",
"217780",
"217820",
"217880",
"217910",
"217950",
"218150",
"218410",
"218420",
"219130",
"219390",
"219420",
"219480",
"219550",
"219750",
"219900",
"220100",
"220130",
"220180",
"220260",
"221800",
"221840",
"221980",
"222040",
"222080",
"222110",
"222160",
"222420",
"222670",
"222800",
"222810",
"222980",
"223190",
"223220",
"223250",
"223310",
"224020",
"224060",
"224110",
"224760",
"224810",
"225030",
"225040",
"225050",
"225060",
"225130",
"225190",
"225220",
"225430",
"225530",
"225570",
"225590",
"225800",
"226320",
"226330",
"226340",
"226360",
"226380",
"226400",
"226440",
"226490",
"226590",
"226950",
"226980",
"227100",
"227420",
"227540",
"227550",
"227560",
"227570",
"227610",
"227830",
"227840",
"227950",
"228340",
"228670",
"228760",
"228790",
"228800",
"228810",
"228820",
"228850",
"229000",
"229200",
"229500",
"229640",
"229720",
"230240",
"230360",
"230480",
"230980",
"232080",
"232140",
"232530",
"232680",
"232830",
"233160",
"233250",
"233740",
"233990",
"234030",
"234070",
"234080",
"234100",
"234300",
"234310",
"234340",
"234690",
"234920",
"235980",
"236030",
"236200",
"236340",
"236350",
"236810",
"237350",
"237370",
"237440",
"237690",
"237750",
"237820",
"237880",
"238090",
"238120",
"238170",
"238200",
"238490",
"238500",
"238670",
"238720",
"239340",
"239610",
"239660",
"239890",
"240550",
"240600",
"240810",
"241180",
"241390",
"241520",
"241560",
"241590",
"241690",
"241710",
"241770",
"241790",
"241820",
"241840",
"242040",
"243070",
"243840",
"243870",
"243880",
"243890",
"244460",
"244580",
"244620",
"244660",
"244670",
"244880",
"244920",
"245340",
"245350",
"245360",
"245450",
"245620",
"245710",
"246250",
"246690",
"246710",
"246720",
"246960",
"247540",
"247660",
"248020",
"248070",
"248170",
"248270",
"249420",
"250000",
"250030",
"250060",
"250730",
"250780",
"250930",
"251120",
"251270",
"251280",
"251340",
"251350",
"251370",
"251590",
"251600",
"251630",
"251970",
"252000",
"252400",
"252410",
"252420",
"252500",
"252650",
"252670",
"252710",
"252990",
"253150",
"253160",
"253230",
"253240",
"253250",
"253280",
"253290",
"253450",
"253590",
"253610",
"253840",
"254120",
"254160",
"254490",
"255220",
"255440",
"256150",
"256440",
"256450",
"256630",
"256750",
"256840",
"256940",
"257370",
"257720",
"257990",
"258050",
"258250",
"258540",
"258610",
"258790",
"258830",
"259630",
"259960",
"260660",
"260870",
"260930",
"260970",
"261060",
"261070",
"261110",
"261120",
"261140",
"261200",
"261220",
"261240",
"261250",
"261260",
"261270",
"261780",
"261920",
"262260",
"262840",
"263020",
"263050",
"263540",
"263600",
"263690",
"263700",
"263720",
"263750",
"263770",
"263800",
"263810",
"263860",
"263920",
"264450",
"264660",
"264850",
"264900",
"26490K",
"265520",
"265560",
"265690",
"265740",
"266160",
"266170",
"266350",
"266360",
"266370",
"266390",
"266410",
"266420",
"266470",
"266550",
"266870",
"267080",
"267250",
"267260",
"267270",
"267290",
"267320",
"267440",
"267450",
"267490",
"267770",
"267790",
"267850",
"267980",
"268280",
"268600",
"269370",
"269420",
"269530",
"269540",
"269620",
"270210",
"270520",
"270660",
"270800",
"270810",
"270870",
"271050",
"271060",
"271560",
"271830",
"271940",
"271980",
"272110",
"272210",
"272290",
"272450",
"272550",
"272560",
"272570",
"272580",
"272910",
"273060",
"273130",
"273140",
"273640",
"274090",
"274400",
"275280",
"275290",
"275300",
"275630",
"275750",
"275980",
"276000",
"276040",
"276240",
"276650",
"276730",
"276970",
"276990",
"277070",
"277410",
"277540",
"277630",
"277640",
"277650",
"277810",
"277880",
"278240",
"278280",
"278470",
"278530",
"278540",
"278620",
"278650",
"278990",
"279060",
"279530",
"279540",
"279600",
"280320",
"280360",
"280920",
"280930",
"280940",
"281740",
"281820",
"281990",
"282000",
"282330",
"282690",
"282720",
"282880",
"283100",
"283580",
"284430",
"284620",
"284740",
"284980",
"285130",
"28513K",
"285490",
"285690",
"285800",
"286000",
"286750",
"286940",
"287180",
"287410",
"287840",
"288330",
"288490",
"288620",
"288980",
"289010",
"289040",
"289080",
"289170",
"289220",
"289250",
"289260",
"289480",
"289670",
"289860",
"289930",
"290080",
"290090",
"290120",
"290130",
"290270",
"290380",
"290520",
"290550",
"290560",
"290650",
"290660",
"290670",
"290690",
"290720",
"290740",
"291130",
"291230",
"291620",
"291630",
"291650",
"291680",
"291810",
"291890",
"292050",
"292150",
"292160",
"292190",
"292500",
"292560",
"292730",
"292770",
"293180",
"293480",
"293490",
"293580",
"293780",
"293940",
"294090",
"294140",
"294400",
"294570",
"294630",
"294870",
"295000",
"295020",
"295040",
"295310",
"296160",
"296520",
"296640",
"297090",
"297570",
"297890",
"298000",
"298020",
"298040",
"298050",
"298060",
"298340",
"298380",
"298540",
"298690",
"298770",
"298830",
"299030",
"299170",
"299480",
"299660",
"299670",
"299900",
"299910",
"300080",
"300120",
"300610",
"300640",
"300720",
"300950",
"301300",
"301400",
"301410",
"302190",
"302430",
"302440",
"302450",
"302550",
"302920",
"303030",
"303360",
"303530",
"303810",
"304100",
"304360",
"304660",
"304670",
"304760",
"304770",
"304780",
"304840",
"304940",
"305050",
"305080",
"305090",
"305540",
"305720",
"306040",
"306200",
"306520",
"306530",
"306620",
"306950",
"307180",
"307280",
"307510",
"307520",
"307750",
"307870",
"307930",
"307950",
"308080",
"308100",
"308170",
"308430",
"308620",
"308700",
"309230",
"309710",
"309930",
"309960",
"310080",
"310200",
"310210",
"310870",
"310960",
"310970",
"311060",
"311320",
"311390",
"311690",
"311960",
"312610",
"313760",
"314130",
"314140",
"314250",
"314700",
"314930",
"315270",
"315640",
"315930",
"315960",
"316140",
"316300",
"316670",
"317120",
"317240",
"317330",
"317400",
"317450",
"317530",
"317690",
"317770",
"317830",
"317850",
"317860",
"317870",
"318000",
"318010",
"318020",
"318060",
"318160",
"318410",
"318660",
"319400",
"319640",
"319660",
"320000",
"321260",
"321370",
"321410",
"321550",
"321820",
"322000",
"322180",
"322190",
"322310",
"322400",
"322410",
"322510",
"322780",
"322970",
"323230",
"323280",
"323350",
"323410",
"323990",
"325010",
"325020",
"326030",
"326230",
"326240",
"327260",
"327610",
"328130",
"328370",
"328380",
"329180",
"329200",
"329650",
"329660",
"329670",
"329750",
"330350",
"330590",
"330730",
"330860",
"331380",
"331520",
"331660",
"331740",
"331910",
"331920",
"332190",
"332290",
"332370",
"332500",
"332570",
"332610",
"332620",
"332930",
"332940",
"333050",
"333430",
"333620",
"333940",
"333950",
"333960",
"333970",
"333980",
"334690",
"334700",
"334890",
"334970",
"335810",
"335870",
"335890",
"336040",
"336060",
"336160",
"336260",
"33626K",
"33626L",
"336370",
"33637K",
"33637L",
"336570",
"336680",
"337120",
"337140",
"337150",
"337160",
"337840",
"337930",
"338100",
"338220",
"338840",
"339770",
"339950",
"340360",
"340440",
"340450",
"340570",
"340810",
"340930",
"341170",
"341310",
"341850",
"342870",
"343090",
"344820",
"344860",
"346000",
"346010",
"347000",
"347700",
"347740",
"347770",
"347850",
"347860",
"347890",
"348030",
"348080",
"348150",
"348210",
"348340",
"348350",
"348370",
"348950",
"350520",
"351020",
"351320",
"351330",
"351870",
"352090",
"352480",
"352540",
"352560",
"352700",
"352770",
"352820",
"352910",
"352940",
"353190",
"353200",
"35320K",
"353590",
"353810",
"354200",
"354240",
"354320",
"354350",
"354390",
"354500",
"355150",
"355390",
"355690",
"356540",
"356680",
"356860",
"356890",
"357120",
"357230",
"357250",
"357430",
"357550",
"357580",
"357780",
"357870",
"357880",
"358570",
"359090",
"359210",
"360070",
"360140",
"360150",
"360200",
"360350",
"360750",
"361390",
"361570",
"361580",
"361610",
"361670",
"362320",
"362990",
"363250",
"363260",
"363280",
"36328K",
"363510",
"363570",
"363580",
"364690",
"364950",
"364960",
"364970",
"364980",
"364990",
"365000",
"365040",
"365270",
"365330",
"365340",
"365550",
"365590",
"365780",
"365900",
"366030",
"367000",
"367380",
"367740",
"367760",
"367770",
"368030",
"368190",
"368590",
"368600",
"368680",
"368770",
"368970",
"369370",
"370090",
"371130",
"371150",
"371160",
"371450",
"371460",
"371470",
"371870",
"371950",
"372170",
"372290",
"372320",
"372330",
"372800",
"372910",
"373110",
"373160",
"373170",
"373200",
"373220",
"373340",
"373490",
"373530",
"373790",
"375270",
"375500",
"37550K",
"37550L",
"375760",
"375770",
"376180",
"376190",
"376270",
"376290",
"376300",
"376410",
"376900",
"376930",
"376980",
"377030",
"377190",
"377220",
"377300",
"377330",
"377400",
"377450",
"377460",
"377480",
"377630",
"377740",
"377990",
"378340",
"378800",
"378850",
"379390",
"379780",
"379790",
"379800",
"379810",
"380320",
"380340",
"380440",
"380540",
"380550",
"381170",
"381180",
"381560",
"381570",
"381620",
"381970",
"382150",
"382480",
"382800",
"382840",
"382900",
"383220",
"383310",
"383800",
"38380K",
"383930",
"384470",
"385510",
"385520",
"385540",
"385550",
"385560",
"385590",
"385600",
"385710",
"385720",
"386580",
"387270",
"387280",
"387570",
"388050",
"388280",
"388420",
"388610",
"388720",
"388790",
"388800",
"388870",
"389020",
"389030",
"389140",
"389260",
"389470",
"389500",
"389650",
"389680",
"390110",
"390390",
"390400",
"390950",
"391060",
"391600",
"391670",
"391680",
"391710",
"393210",
"393360",
"393890",
"393970",
"394280",
"394340",
"394350",
"394660",
"394670",
"394800",
"395150",
"395160",
"395170",
"395270",
"395280",
"395290",
"395400",
"395750",
"395760",
"396270",
"396300",
"396470",
"396500",
"396510",
"396520",
"396690",
"397030",
"397410",
"397420",
"397810",
"397880",
"398120",
"399110",
"399580",
"399720",
"400570",
"400580",
"400590",
"400760",
"400840",
"400970",
"401170",
"401470",
"401590",
"402030",
"402340",
"402420",
"402460",
"402490",
"402520",
"402970",
"403360",
"403490",
"403550",
"403790",
"403870",
"404120",
"404260",
"404470",
"404540",
"404650",
"404950",
"404990",
"405000",
"405100",
"405640",
"405920",
"406760",
"406820",
"407160",
"407170",
"407300",
"407310",
"407400",
"407820",
"407830",
"408900",
"408920",
"409810",
"409820",
"410870",
"411050",
"411060",
"411080",
"411420",
"411540",
"411720",
"411860",
"412350",
"412540",
"412560",
"412570",
"412770",
"412930",
"413220",
"413300",
"413390",
"413600",
"413630",
"413640",
"413930",
"414270",
"414780",
"415340",
"415380",
"415580",
"415640",
"415760",
"415920",
"416090",
"416180",
"417010",
"417180",
"417200",
"417310",
"417450",
"417500",
"417630",
"417790",
"417840",
"417860",
"417970",
"418170",
"418210",
"418250",
"418420",
"418470",
"418550",
"418620",
"418660",
"418670",
"419050",
"419080",
"419120",
"419170",
"419270",
"419420",
"419430",
"419530",
"419540",
"419650",
"419700",
"419890",
"420570",
"420770",
"421320",
"421800",
"422040",
"422260",
"422420",
"423160",
"423170",
"423920",
"424140",
"424460",
"424760",
"424870",
"424960",
"424980",
"425040",
"425290",
"425420",
"426020",
"426030",
"426150",
"426330",
"426410",
"426550",
"427110",
"427120",
"427950",
"428510",
"428560",
"429000",
"429010",
"429270",
"429740",
"429760",
"429870",
"429980",
"429990",
"430220",
"430230",
"430460",
"430500",
"430690",
"430700",
"431190",
"432320",
"432430",
"432470",
"432600",
"432720",
"432840",
"432850",
"432980",
"433220",
"433250",
"433330",
"433500",
"433530",
"433850",
"433860",
"433870",
"433880",
"433970",
"433980",
"434060",
"434190",
"434480",
"434730",
"434960",
"435040",
"435380",
"435420",
"435530",
"435540",
"435550",
"435570",
"435620",
"435870",
"436140",
"436180",
"436530",
"436610",
"437070",
"437080",
"437350",
"437370",
"437550",
"437730",
"437780",
"438080",
"438100",
"438210",
"438220",
"438320",
"438330",
"438560",
"438570",
"438580",
"438700",
"438740",
"438900",
"439090",
"439250",
"439260",
"439410",
"439580",
"439730",
"439860",
"439870",
"440110",
"440290",
"440320",
"440340",
"440640",
"440650",
"440790",
"440820",
"440910",
"441270",
"441330",
"441540",
"441640",
"441680",
"441800",
"442090",
"442130",
"442260",
"442310",
"442320",
"442550",
"442560",
"442570",
"442580",
"442770",
"442900",
"443060",
"443250",
"443670",
"444200",
"444490",
"444530",
"444920",
"445090",
"445150",
"445180",
"445290",
"445360",
"445680",
"445690",
"445910",
"445930",
"445950",
"445970",
"446070",
"446150",
"446190",
"446440",
"446540",
"446600",
"446690",
"446700",
"446720",
"446750",
"446770",
"446840",
"447430",
"447620",
"447660",
"447690",
"447770",
"447820",
"448100",
"448280",
"448290",
"448300",
"448330",
"448370",
"448490",
"448510",
"448540",
"448570",
"448600",
"448630",
"448710",
"448730",
"448740",
"448760",
"448780",
"448830",
"448880",
"448900",
"449020",
"449170",
"449180",
"449190",
"449450",
"449580",
"449680",
"449690",
"449770",
"449780",
"450050",
"450080",
"450120",
"450140",
"45014K",
"450180",
"450190",
"450330",
"450410",
"450520",
"450910",
"450940",
"450950",
"451000",
"451060",
"451150",
"451220",
"451250",
"451530",
"451540",
"451600",
"451670",
"451700",
"451760",
"451800",
"452160",
"452190",
"452200",
"452250",
"452260",
"45226K",
"452280",
"452300",
"452360",
"452400",
"452430",
"452440",
"452450",
"452670",
"452980",
"453010",
"453060",
"453080",
"453330",
"453340",
"453450",
"453540",
"453630",
"453640",
"453650",
"453660",
"453810",
"453820",
"453850",
"453860",
"453870",
"453950",
"454180",
"454320",
"454640",
"454750",
"454780",
"454910",
"455030",
"455180",
"455250",
"455310",
"455660",
"455850",
"455860",
"455890",
"455900",
"455910",
"455960",
"456010",
"456040",
"456070",
"456100",
"456160",
"456190",
"456200",
"456250",
"456440",
"456490",
"456570",
"456600",
"456610",
"456680",
"456700",
"456880",
"457190",
"457370",
"457390",
"457480",
"457550",
"457600",
"457630",
"457690",
"457700",
"457930",
"457940",
"457990",
"458030",
"458210",
"458250",
"458260",
"458320",
"458610",
"458650",
"458730",
"458750",
"458760",
"458870",
"459100",
"459370",
"459510",
"459560",
"459580",
"459750",
"459790",
"460270",
"460280",
"460470",
"460660",
"460850",
"460860",
"460870",
"460930",
"460940",
"460960",
"461030",
"461260",
"461270",
"461300",
"461340",
"461450",
"461460",
"461490",
"461500",
"461580",
"461600",
"461900",
"461910",
"461950",
"462010",
"462020",
"462310",
"462330",
"462340",
"462350",
"462510",
"462520",
"462540",
"462860",
"462870",
"462900",
"462980",
"463020",
"463050",
"463250",
"463290",
"463300",
"463480",
"463640",
"463680",
"463690",
"464060",
"464080",
"464230",
"464240",
"464280",
"464310",
"464440",
"464470",
"464500",
"464540",
"464580",
"464600",
"464610",
"464680",
"464920",
"464930",
"465320",
"465330",
"465350",
"465480",
"465580",
"465610",
"465620",
"465660",
"465670",
"465680",
"465770",
"465780",
"466100",
"466400",
"466410",
"466810",
"466910",
"466920",
"466930",
"466940",
"466950",
"467540",
"467620",
"467930",
"467940",
"468370",
"468380",
"468530",
"468630",
"468760",
"468820",
"469050",
"469060",
"469070",
"469150",
"469160",
"469170",
"469480",
"469530",
"469580",
"469750",
"469790",
"469820",
"469830",
"469880",
"469900",
"470260",
"470310",
"470320",
"471040",
"471050",
"471230",
"471290",
"471460",
"471760",
"471780",
"471820",
"471990",
"472150",
"472160",
"472170",
"472220",
"472230",
"472350",
"472490",
"472720",
"472830",
"472840",
"472850",
"472870",
"472920",
"473000",
"473050",
"473290",
"473330",
"473370",
"473380",
"473440",
"473460",
"473490",
"473500",
"473590",
"473640",
"473950",
"473980",
"474170",
"474220",
"474390",
"474490",
"474590",
"474610",
"474650",
"474660",
"474800",
"474920",
"474930",
"475050",
"475070",
"475080",
"475150",
"475230",
"475240",
"475250",
"475260",
"475270",
"475280",
"475300",
"475310",
"475350",
"475380",
"475400",
"475430",
"475460",
"475560",
"475580",
"475630",
"475660",
"475720",
"475830",
"475960",
"476000",
"476030",
"476040",
"476060",
"476070",
"476080",
"476260",
"476310",
"476450",
"476550",
"476690",
"476710",
"476750",
"476760",
"476800",
"476810",
"476850",
"477050",
"477080",
"477340",
"477380",
"477470",
"477490",
"477730",
"477760",
"478110",
"478150",
"478390",
"478440",
"478560",
"478780",
"479080",
"479520",
"479620",
"479730",
"479850",
"479880",
"479960",
"480020",
"480030",
"480040",
"480260",
"480310",
"480370",
"480460",
"481050",
"481060",
"481070",
"481180",
"481190",
"481200",
"481340",
"481430",
"481850",
"481890",
"482030",
"482520",
"482630",
"482680",
"482690",
"482730",
"482870",
"483020",
"483030",
"483230",
"483240",
"483280",
"483290",
"483320",
"483330",
"483340",
"483420",
"483570",
"483650",
"484120",
"484130",
"484590",
"484790",
"484810",
"484870",
"484880",
"484890",
"485540",
"485690",
"485810",
"486240",
"486290",
"486450",
"486630",
"486780",
"486790",
"486830",
"487130",
"487230",
"487240",
"487340",
"487360",
"487570",
"487720",
"487750",
"487830",
"487910",
"487920",
"487950",
"488060",
"488080",
"488200",
"488210",
"488280",
"488290",
"488480",
"488500",
"488720",
"488770",
"488980",
"489000",
"489010",
"489030",
"489210",
"489250",
"489290",
"489460",
"489480",
"489500",
"489570",
"489730",
"489790",
"489860",
"490090",
"490330",
"490480",
"490490",
"490590",
"490600",
"491010",
"491080",
"491090",
"491220",
"491230",
"491510",
"491610",
"491620",
"491630",
"491700",
"491820",
"491830",
"492220",
"492500",
"493420",
"493790",
"493810",
"494180",
"494210",
"494220",
"494300",
"494310",
"494330",
"494340",
"494410",
"494420",
"494670",
"494840",
"494890",
"494900",
"495040",
"495050",
"495060",
"495230",
"495330",
"495550",
"495710",
"495750",
"495810",
"495850",
"495900",
"495940",
"496020",
"496070",
"496080",
"496090",
"496120",
"496130",
"496320",
"496770",
"497510",
"497520",
"497570",
"497780",
"497880",
"498050",
"498180",
"498270",
"498390",
"498400",
"498410",
"498610",
"498860",
"499150",
"499660",
"499790",
"900070",
"900100",
"900110",
"900120",
"900140",
"900250",
"900260",
"900270",
"900280",
"900290",
"900300",
"900310",
"900340",
"950110",
"950130",
"950140",
"950160",
"950170",
"950190",
"950200",
"950210",
"950220"
    ]),
}

# =========================================================
# 3️⃣ 최신 날짜 조회 함수
# =========================================================
def get_latest_dates_from_mongo(db, collection_name, symbols):
    """MongoDB에서 각 심볼별 최신 날짜를 조회"""
    collection = db[collection_name]
    latest_dates = {}

    pipeline = [
        {"$match": {"symbol": {"$in": symbols}}},
        {"$sort": {"date": -1}},
        {"$group": {"_id": "$symbol", "max_date": {"$first": "$date"}}}
    ]

    try:
        for doc in collection.aggregate(pipeline, allowDiskUse=True):
            max_date = doc.get('max_date')
            if isinstance(max_date, datetime):
                latest_dates[doc['_id']] = max_date.strftime("%Y-%m-%d")
            elif isinstance(max_date, str):
                latest_dates[doc['_id']] = max_date
    except Exception as e:
        print(f"[{collection_name}] 최신 날짜 조회 오류: {e}")

    return latest_dates


# =========================================================
# 4️⃣ Ticker 데이터 다운로드 및 DB 저장
# =========================================================
def fetch_and_insert_ticker(symbol: str, collection, latest_date_map: dict):
    """단일 티커 데이터를 가져와 MongoDB에 저장"""
    today = datetime.now().date()
    tomorrow = today + timedelta(days=1)

    latest_date_str = latest_date_map.get(symbol)
    start_date = "1900-01-01"

    if latest_date_str:
        latest_date = datetime.strptime(latest_date_str, "%Y-%m-%d").date()
        start_date = (latest_date + timedelta(days=1)).strftime("%Y-%m-%d")
        if latest_date >= today:
            print(f"[{symbol}] ✅ 최신 상태 (최신 날짜: {latest_date_str})")
            return
        print(f"[{symbol}] 업데이트 시작 (시작일: {start_date})")
    else:
        print(f"[{symbol}] 전체 데이터 다운로드 시작")

    try:
        stock = yf.Ticker(symbol, session=session)
        df = stock.history(start=start_date, end=tomorrow.strftime("%Y-%m-%d"))
    except Exception as e:
        print(f"[{symbol}] 다운로드 실패: {e}")
        return

    if df.empty:
        print(f"[{symbol}] 데이터 없음 또는 잘못된 심볼")
        return

    df = df.reset_index()
    documents = []

    for _, row in df.iterrows():
        try:
            date_obj = pd.to_datetime(row['Date']).to_pydatetime()
        except Exception:
            continue

        volume_value = int(row['Volume']) if not pd.isna(row['Volume']) else 0
        doc = {
            "symbol": symbol,
            "date": date_obj,
            "open": float(row["Open"]),
            "high": float(row["High"]),
            "low": float(row["Low"]),
            "close": float(row["Close"]),
            "volume": volume_value,
        }

        if "Dividends" in df.columns:
            doc["dividends"] = float(row["Dividends"])
        if "Stock Splits" in df.columns:
            doc["stock_splits"] = float(row["Stock Splits"])

        documents.append(doc)

    if not documents:
        print(f"[{symbol}] 삽입할 데이터 없음")
        return

    try:
        collection.insert_many(documents, ordered=False)
        print(f"[{symbol}] {len(documents)}건 삽입 완료")
    except BulkWriteError as bwe:
        duplicates = len([e for e in bwe.details.get("writeErrors", []) if e.get("code") == 11000])
        inserted = len(documents) - duplicates
        print(f"[{symbol}] {inserted}건 삽입, {duplicates}건 중복")
    except Exception as e:
        print(f"[{symbol}] DB 삽입 오류: {e}")


# =========================================================
# 5️⃣ 병렬 실행 및 세션 종료
# =========================================================
def run_parallel_update():
    start_time = time.time()

    try:
        client = MongoClient(MONGO_URI, serverSelectionTimeoutMS=5000)
        client.admin.command("ping")
        db = client[DATABASE_NAME]
    except ServerSelectionTimeoutError as e:
        print(f"❌ MongoDB 연결 실패: {e}")
        return
    except Exception as e:
        print(f"❌ MongoDB 초기화 오류: {e}")
        return

    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
        all_futures = []
        for type_name, symbols in TICKER_LISTS.items():
            collection_name = COLLECTION_NAMES[type_name]
            collection = db[collection_name]

            # 기존 인덱스 충돌 시 제거 후 재생성
            existing_indexes = collection.index_information()
            for name, info in existing_indexes.items():
                if info.get("key") == [('symbol', 1), ('date', 1)]:
                    print(f"⚙️ {collection_name}: 기존 인덱스 제거")
                    collection.drop_index(name)
                    break

            collection.create_index(
                [("symbol", 1), ("date", 1)],
                unique=True,
                name="symbol_date_unique_index"
            )

            print(f"\n🚀 {collection_name} 업데이트 시작 ({len(symbols)}개 티커)")

            latest_dates = get_latest_dates_from_mongo(db, collection_name, symbols)
            for symbol in symbols:
                future = executor.submit(fetch_and_insert_ticker, symbol, collection, latest_dates)
                all_futures.append(future)

        for future in as_completed(all_futures):
            try:
                future.result()
            except Exception as e:
                print(f"❗ 스레드 예외 발생: {e}")

    client.close()
    session.close()  # ✅ 스크립트 종료 시 세션 닫기

    end_time = time.time()
    print("\n=======================================================")
    print(f"🎉 전체 업데이트 완료! 소요 시간: {end_time - start_time:.2f}초")
    print("=======================================================")


# =========================================================
# 6️⃣ 실행
# =========================================================
if __name__ == "__main__":
    run_parallel_update()
